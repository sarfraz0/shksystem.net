{% extends 'menu.html' %}
{% block title %}Feeds Management{% endblock %}
{% block css %}{{ url_for('static', filename='css/feeds.css') }}{% endblock %}
{% block content %}

{% if mode == 'MODIFY' %}
<form action="{{ url_for('manage_feeds', mode='MODIFY') }}" method="post">
    {{ modify_form.hidden_tag() }}
    <div class="row">
        <div class="large-12 columns">
            <fieldset>
                <legend>Modify feed</legend>

                <div class="row">
                    <div class="large-6 columns">
                        {{ modify_form.name.label }}
                        {{ modify_form.name }}
                    </div>
                    <div class="large-6 columns">
                        {{ modify_form.category.label }}
                        {{ modify_form.category }}
                    </div>
                </div>

                <div class="row">
                    <div class="large-12 columns">
                        {{ modify_form.regex.label }}
                        {{ modify_form.regex }}
                    </div>
                </div>

                <div class="row">
                    <div class="large-12 columns">
                        {{ modify_form.strike_url.label }}
                        {{ modify_form.strike_url }}
                    </div>
                </div>

                <div class="row">
                    <div class="large-12 columns">
                        {{ modify_form.kickass_url.label }}
                        {{ modify_form.kickass_url }}
                    </div>
                </div>

                <div class="row">

                    <div class="large-4 columns">
                        {{ modify_form.is_active }}{{ modify_form.is_active.label }}
                    </div>

                    <div class="large-4 columns">
                        {{ modify_form.has_episodes }}{{ modify_form.has_episodes.label }}
                    </div>

                    <div class="large-4 columns">
                        {{ modify_form.has_seasons }}{{ modify_form.has_seasons.label }}
                    </div>

                </div>

                <div class="row">
                    <div class="large-12 columns">
                        {{ modify_form.dest.label }}
                        {{ modify_form.dest }}
                    </div>
                </div>

                <div class="row">
                    <div class="large-3 large-offset-9 columns">
                        <input type="submit" value="Submit" class="button">
                    </div>
                </div>

            </fieldset>
        </div>
    </div>
</form>

<script type="text/javascript" charset="utf-8">
function get_feed() {
$.getJSON($SCRIPT_ROOT + "/api/ajax/get_feed/"+ $("#{{ modify_form.name.id }}").val(),
    function(data) {
    $("#{{ modify_form.category.id }}").prop("value", data.CATEGORY);
    $("#{{ modify_form.regex.id }}").prop("value", data.REGEX);
    $("#{{ modify_form.strike_url.id }}").prop("value", data.STRIKE_URL);
    $("#{{ modify_form.kickass_url.id }}").prop("value", data.KICKASS_URL);
    $("#{{ modify_form.dest.id }}").prop("value", data.DEST);
    $("#{{ modify_form.has_episodes.id }}").prop("checked", data.HAS_EPISODES);
    $("#{{ modify_form.has_seasons.id }}").prop("checked", data.HAS_SEASONS);
    $("#{{ modify_form.is_active.id }}").prop("checked", data.IS_ACTIVE);
  });
}
get_feed();
$("#{{ modify_form.name.id }}").change(function(e) { get_feed(); });
</script>
{% endif %}

{% if mode == 'ADD' %}
<form action="{{ url_for('manage_feeds', mode='ADD') }}" method="post">
    {{ add_form.hidden_tag() }}
    <div class="row">
        <div class="large-12 columns">
            <fieldset>
                <legend>Add feed</legend>

                <div class="row">
                    <div class="large-6 columns">
                        {{ add_form.name.label }}
                        {{ add_form.name(autofocus=true, required=true) }}
                    </div>
                    <div class="large-6 columns">
                        {{ add_form.category.label }}
                        {{ add_form.category(autofocus=true, required=true) }}
                    </div>
                </div>

                <div class="row">
                    <div class="large-12 columns">
                        {{ add_form.regex.label }}
                        {{ add_form.regex(autofocus=true, required=true) }}
                    </div>
                </div>

                <div class="row">
                    <div class="large-12 columns">
                        {{ add_form.strike_url.label }}
                        {{ add_form.strike_url(autofocus=true, required=true) }}
                    </div>
                </div>

                <div class="row">
                    <div class="large-12 columns">
                        {{ add_form.kickass_url.label }}
                        {{ add_form.kickass_url(autofocus=true, required=true) }}
                    </div>
                </div>

                <div class="row">
                    <div class="large-12 columns">
                        {{ add_form.dest.label }}
                        {{ add_form.dest }}
                    </div>
                </div>

                <div class="row">

                    <div class="large-4 columns">
                        {{ add_form.is_active }}{{ add_form.is_active.label }}
                    </div>

                    <div class="large-4 columns">
                        {{ add_form.has_episodes }}{{ add_form.has_episodes.label }}
                    </div>

                    <div class="large-4 columns">
                        {{ add_form.has_seasons }}{{ add_form.has_seasons.label }}
                    </div>

                </div>

                <div class="row">
                    <div class="large-3 large-offset-9 columns">
                        <input type="submit" value="Submit" class="button">
                    </div>
                </div>

            </fieldset>
        </div>
    </div>
</form>
{% endif %}

{% if mode == 'REMOVE' %}
<form action="{{ url_for('manage_feeds', mode='REMOVE') }}" method="post">
    {{ remove_form.hidden_tag() }}
    <div class="row">
        <div class="large-12 columns">
            <fieldset>
                <legend>Remove feed</legend>

                <div class="row">
                    <div class="large-12 columns">
                        {{ remove_form.name.label }}
                        {{ remove_form.name }}
                    </div>
                </div>

                <div class="row">
                    <div class="large-12 columns">
                        <input type="submit" value="Submit" class="button expand">
                    </div>
                </div>

            </fieldset>
        </div>
    </div>
</form>
{% endif %}

{% endblock %}
